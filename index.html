<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mold Detector</title>
    <!-- Load TensorFlow.js library -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <!-- Load the Teachable Machine library -->
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.4/dist/teachablemachine-image.min.js"></script>
</head>
<body>
    <h1>Mold Detector</h1>
    
    <!-- Button to start the prediction -->
    <button onclick="startPrediction()">Take Picture and Predict</button>

    <!-- Display prediction result -->
    <div id="predictionResult"></div>

    <script>
        let model;
        const URL = "https://teachablemachine.withgoogle.com/models/JbNhrDeuF/"; // Your model's URL

        // Load the model
        async function loadModel() {
            model = await tmImage.load(`${URL}model.json`);
            console.log("Model loaded successfully!");
        }

        // Function to receive the image from Thunkable
        function receiveImage(imageURL) {
            const imageElement = document.createElement('img');
            imageElement.src = imageURL;

            imageElement.onload = async function() {
                const prediction = await model.predict(imageElement);
                document.getElementById("predictionResult").innerText = 
                    `Prediction: ${prediction[0].className} with ${Math.round(prediction[0].probability * 100)}% confidence`;
            };
        }

        // This function is called when you want to start the prediction process
        async function startPrediction() {
            // The URL parameter 'image' should be passed from Thunkable
            const imageURL = getParameterByName('image');
            if (imageURL) {
                receiveImage(imageURL);
            } else {
                document.getElementById("predictionResult").innerText = "No image provided.";
            }
        }

        // Function to extract URL parameters
        function getParameterByName(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Load the model when the page starts
        window.onload = function() {
            loadModel();
        };
    </script>
</body>
</html>


